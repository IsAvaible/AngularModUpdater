<div class="flex w-full flex-col items-center px-10">
  <app-start-button [loading]="this.loading" (notify)="startUpdateMods()" />

  <div class="mt-4 flex w-full flex-col">
    <div class="w-full">
      @if (loading) {
        <app-loading-indicator [percent]="this.loadingPercent" />
      }
    </div>
    @if (availableMods.length > 0) {
      <section class="space-y-4">
        <div class="flex items-center justify-between space-x-3">
          <p class="text-lg font-bold dark:text-slate-100">
            Mods which have releases for the selected version
          </p>
          <div class="flex items-center space-x-2">
            <!-- Search Input -->
            <div class="relative">
              <input
                type="text"
                placeholder="Search results..."
                class="h-10 w-48 rounded-md pl-10 pr-4 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-gray-400 dark:bg-slate-800 dark:text-slate-200 dark:ring-slate-500 dark:hover:ring-slate-200"
                [(ngModel)]="searchTerm"
                aria-label="Search results"
              />
              <svg
                class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
                />
              </svg>
            </div>

            <button
              class="flex aspect-square h-10 items-center justify-center rounded-md bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:ring-gray-400 focus:outline-none focus:ring-gray-400 dark:bg-slate-800 dark:text-slate-100 dark:ring-slate-500 dark:hover:ring-slate-200"
              (click)="
                availableModsView =
                  availableModsView == View.List ? View.Grid : View.List
              "
              [attr.aria-label]="
                availableModsView === View.List
                  ? 'Switch to grid view'
                  : 'Switch to list view'
              "
            >
              @switch (availableModsView) {
                @case (View.List) {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-6 w-6"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
                    />
                  </svg>
                }
                @case (View.Grid) {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-6 w-6"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M14 20.4v-5.8a.6.6 0 01.6-.6h5.8a.6.6 0 01.6.6v5.8a.6.6 0 01-.6.6h-5.8a.6.6 0 01-.6-.6zM3 20.4v-5.8a.6.6 0 01.6-.6h5.8a.6.6 0 01.6.6v5.8a.6.6 0 01-.6.6H3.6a.6.6 0 01-.6-.6zM14 9.4V3.6a.6.6 0 01.6-.6h5.8a.6.6 0 01.6.6v5.8a.6.6 0 01-.6.6h-5.8a.6.6 0 01-.6-.6zM3 9.4V3.6a.6.6 0 01.6-.6h5.8a.6.6 0 01.6.6v5.8a.6.6 0 01-.6.6H3.6a.6.6 0 01-.6-.6z"
                    />
                  </svg>
                }
              }
            </button>
          </div>
        </div>
        @if (primaryMods.length > 0) {
          <app-mod-list
            [mods]="primaryMods"
            [view]="availableModsView"
            [order]="order"
          />
        }
        @if (dependencyMods.length > 0) {
          <p class="pt-4 text-lg font-bold dark:text-slate-100">
            Required Dependencies
          </p>
          <app-mod-list
            [mods]="dependencyMods"
            [view]="availableModsView"
            [order]="order"
          />
        }
        <div
          class="flex justify-between rounded-lg bg-white px-4 py-2 dark:bg-slate-800 dark:text-slate-300"
        >
          <span class="flex items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5 dark:text-slate-100"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"
              />
            </svg>
            <button
              (click)="downloadUpdated()"
              class="flex items-center gap-x-2 rounded-lg bg-white py-1 px-2 hover:underline dark:bg-slate-800 dark:text-slate-200"
            >
              Download Updated
            </button>
          </span>
          <span class="flex items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"
              />
            </svg>
            <button
              (click)="showScriptGenerator = true"
              class="flex items-center gap-x-2 rounded-lg bg-white py-1 px-2 hover:underline dark:bg-slate-800 dark:text-slate-200"
            >
              Generate Script
            </button>
          </span>
          <span class="flex items-center">
            <button
              (click)="downloadAll()"
              class="flex items-center gap-x-2 rounded-lg bg-white py-1 px-2 hover:underline dark:bg-slate-800 dark:text-slate-200"
            >
              Download All
            </button>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5 dark:text-slate-100"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M7.5 7.5h-.75A2.25 2.25 0 0 0 4.5 9.75v7.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25v-7.5a2.25 2.25 0 0 0-2.25-2.25h-.75m-6 3.75 3 3m0 0 3-3m-3 3V1.5m6 9h.75a2.25 2.25 0 0 1 2.25 2.25v7.5a2.25 2.25 0 0 1-2.25 2.25h-7.5a2.25 2.25 0 0 1-2.25-2.25v-.75"
              />
            </svg>
          </span>
        </div>
      </section>
    }
    @if (unavailableMods.length > 0) {
      <app-mod-info-section
        [title]="'Mods which have no releases for the selected version'"
        [mods]="unavailableMods"
        [type]="'warning'"
      />
    }
    @if (invalidLoaderMods.length > 0) {
      <app-mod-info-section
        [title]="'Mods which are not available for the selected mod-loader'"
        [mods]="invalidLoaderMods"
        [type]="'warning'"
      />
    }
    @if (unresolvedMods.length > 0) {
      <app-mod-info-section
        [title]="'Mods that the site was not able to fetch'"
        [mods]="unresolvedMods"
        [type]="'error'"
      />
    }
  </div>
</div>

@if (showScriptGenerator) {
  <app-script-generator
    [mods]="availableMods"
    (closeEvent)="showScriptGenerator = false"
  />
}
